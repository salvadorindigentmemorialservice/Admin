<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salvador Indigent Memorial Services - Interment Form</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Homemade+Apple&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Impact&display=swap'); /* Ensure Impact is loaded if needed */

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #f5f5f5;
            font-family: Arial, sans-serif;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            width: 100%;
            max-width: 800px;
            background-color: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .form-header {
            text-align: center;
            margin-bottom: 25px;
            color: #003366;
        }

        .logo-container {
            display: flex;
            justify-content: center;
            margin-bottom: 15px;
        }

        .logo {
            width: 200px;
            height: 200px;
        }

        h1 {
            color: #003366;
            font-size: 24px;
            margin-bottom: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #003366;
        }

        input[type="text"],
        input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
        }

        input:focus {
            border-color: #003366;
            outline: none;
            box-shadow: 0 0 0 2px rgba(0, 51, 102, 0.1);
        }

        .buttons {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            flex: 1;
            padding: 12px 15px;
            background-color: #003366;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            min-width: 140px;
        }

        .btn-print {
            background-color: #00802b;
        }

        .btn-save {
            background-color: #8e44ad;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .nav-links {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            gap: 20px;
        }

        .nav-link {
            color: #003366;
            text-decoration: none;
            font-weight: bold;
        }

        .nav-link:hover {
            text-decoration: underline;
        }

        /* --- A4 Paper Preview --- */
        #interment-preview {
            width: 210mm; /* A4 width */
            height: 297mm; /* A4 height - Fixed height */
            background-color: white;
            margin: 30px auto; /* Add margin for better separation on screen */
            position: relative;
            box-sizing: border-box;
            overflow: hidden; /* Hide overflow */
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            border: 1px solid #ccc; /* Add border for visual separation */
        }

        /* --- Styles for the content inside the A4 preview --- */
        .print-form {
            width: 100%;
            height: 100%; /* Make it fill the parent */
            padding: 30mm 15mm 20mm 15mm; /* Adjust padding (Top, R/L, Bottom) */
            display: flex; /* Use Flexbox */
            flex-direction: column; /* Stack elements vertically */
            align-items: center; /* Center logo */
            box-sizing: border-box;
            font-family: Arial, sans-serif; /* Default font */
        }

        .sims-logo {
            width: 200px; /* Slightly larger logo */
            height: 200px;
            margin-top: 0; /* Rely on container padding */
            margin-bottom: 35px; /* Increased space below logo */
        }

        .memory-text {
            font-family: 'Homemade Apple', cursive; /* Cursive font */
            font-size: 30px; /* Slightly larger */
            margin-bottom: 35px; /* Increased space below */
            color: #2952a3; /* Blue color from image */
            text-align: center;
        }

        .name-text {
            font-family: Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif; /* Bold, blocky font */
            font-size: 58px; /* Slightly larger */
            font-weight: bold; /* Ensure bold */
            color: black;
            text-align: center;
            margin-bottom: 30px; /* Increased space below name */
            letter-spacing: 1px;
            line-height: 1.1;
        }

        .detail-text {
            font-family: Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif; /* Bold, blocky font */
            font-size: 38px; /* Slightly larger */
            font-weight: bold; /* Ensure bold */
            color: black;
            text-align: left;
            width: 100%;
            padding: 0 10px; /* Indent slightly */
            margin-bottom: 12px; /* Increased space between details */
            letter-spacing: 1px;
        }
         /* Add extra margin after the last detail */
        #preview-age {
             margin-bottom: 25px; /* More space before the box */
        }

        /* Box for Interment Date and Placed */
        .interment-details-box {
            border: 2px solid black;
            width: 100%;
            margin-top: 30px; /* Increased space above box */
            margin-bottom: 40px; /* Increased space below box */
            padding: 20px 25px; /* Increased padding inside box */
            box-sizing: border-box;
        }

        .interment-line {
            font-family: Arial, sans-serif; /* Standard font */
            font-size: 22px; /* Slightly larger */
            font-weight: bold; /* Make labels bold */
            text-align: left;
            width: 100%;
            margin-bottom: 20px; /* Increased space between lines */
            display: flex;
            align-items: baseline; /* Align text baseline */
        }
         .interment-line:last-child {
             margin-bottom: 5px; /* Less margin for the last item in box */
         }

        .line-label {
            white-space: nowrap; /* Prevent label wrapping */
            margin-right: 8px; /* Space between label and line */
        }

        .line-content {
            flex-grow: 1; /* Take remaining space */
            border-bottom: 2px solid black;
            height: 1.2em; /* Height relative to font size */
            display: inline-block;
            font-weight: normal; /* Input text not bold */
            font-size: 20px; /* Slightly larger input text size */
            padding-left: 5px;
            overflow: hidden; /* Hide overflowing text */
            white-space: nowrap; /* Prevent text wrapping */
            text-overflow: ellipsis; /* Show ... for overflow */
        }

        /* Serviced By Section */
         .serviced-by-label {
             font-family: Arial, sans-serif;
             font-size: 22px; /* Slightly larger */
             text-align: left;
             width: 100%;
             padding: 0 10px; /* Match indent of details */
             margin-bottom: 8px; /* Increased space below label */
             font-weight: bold;
         }

        .service-name-colored {
            font-family: Arial, sans-serif;
            font-size: 24px; /* Slightly larger */
            font-weight: bold;
            text-align: left;
            width: 100%;
            padding: 0 10px; /* Match indent of details */
            margin-bottom: 20px; /* Increased space below service name */
        }

        /* Colors for Service Name - matched from image */
        .salvador { color: #8BC34A; } /* Green */
        .indigent { color: #2952a3; } /* Blue */
        .memorial { color: #F44336; } /* Red */
        .services { color: #673AB7; } /* Purple */

        .address-line {
            font-family: Arial, sans-serif;
            font-size: 15px; /* Slightly larger */
            text-align: left;
            width: 100%;
            padding: 0 10px; /* Match indent */
            line-height: 1.5; /* Slightly more line spacing */
            margin-top: auto; /* Push this element to the bottom */
            /* padding-bottom is handled by container padding now */
        }

        /* Preview container for saved image */
        #preview-container {
            display: none;
            margin: 20px 0;
            padding: 20px;
            border: 1px dashed #ccc;
            text-align: center;
            background-color: white;
            border-radius: 8px;
        }

        #preview-container h3 {
            margin-bottom: 15px;
            color: #003366;
        }

        #preview-image {
            max-width: 100%;
            height: auto;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            border: 1px solid #eee;
        }

        #download-link {
            display: inline-block;
            margin-top: 15px;
            padding: 10px 20px;
            background-color: #8e44ad;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            font-weight: bold;
            transition: all 0.2s;
        }

        #download-link:hover {
            background-color: #7d3c98;
            transform: translateY(-2px);
        }

        /* Print styles - ensure only the preview prints */
        @media print {
            @page {
                size: A4 portrait;
                margin: 0; /* Remove browser default margins */
            }

            body, html {
                margin: 0;
                padding: 0;
                background: white;
                box-shadow: none;
                -webkit-print-color-adjust: exact; /* Ensure colors print */
                 print-color-adjust: exact;
            }

            .container, .form-header, .form-group, .buttons, .nav-links, #preview-container, #interment-preview {
                 box-shadow: none !important;
                 border: none !important;
                 margin: 0 !important;
                 padding: 0 !important; /* Reset padding for preview container itself */
            }

            .container, .buttons, .nav-links, #preview-container {
                display: none !important; /* Hide non-print elements */
            }

             #interment-preview {
                 display: block !important;
                 position: relative; /* Use relative for normal flow */
                 top: 0;
                 left: 0;
                 width: 210mm;
                 height: 297mm; /* Force height for printing */
                 overflow: hidden; /* Clip content if it overflows */
                 border: none !important; /* Remove screen border */
                 margin: 0 !important; /* Remove screen margin */
                 box-shadow: none !important; /* Remove screen shadow */
             }

            .print-form {
                 padding: 25mm 15mm 15mm 15mm; /* Adjust print margins if needed */
                 height: 100%; /* Ensure it fills the preview div */
                 box-sizing: border-box; /* Include padding in height */
            }
        }
    </style>
</head>
<body>
    <!-- Input Form Container (Remains the Same) -->
    <div class="container">
        <div class="form-header">
            <div class="logo-container">
                <img src="logo.png" alt="Salvador Indigent Memorial Services Logo" class="logo">
            </div>
            <h1>Salvador Indigent Memorial Services - Interment Form</h1>
        </div>

        <div class="form-group">
            <label for="name">Full Name</label>
            <input type="text" id="name" name="name" placeholder="Enter full name of the deceased">
        </div>

        <div class="form-group">
            <label for="born">Born Date</label>
            <input type="text" id="born" name="born" placeholder="e.g., July 10, 1956">
        </div>

        <div class="form-group">
            <label for="died">Died Date</label>
            <input type="text" id="died" name="died" placeholder="e.g., March 26, 2023">
        </div>

        <div class="form-group">
            <label for="age">Age (in years)</label>
            <input type="number" id="age" name="age" placeholder="Enter age e.g., 66">
        </div>

        <div class="form-group">
            <label for="interment-date">Date of Interment</label>
            <input type="text" id="interment-date" name="interment-date" placeholder="Enter interment date">
        </div>

        <div class="form-group">
            <label for="placed">Placed</label>
            <input type="text" id="placed" name="placed" placeholder="Enter where placed">
        </div>

        <div class="buttons">
            <button type="button" id="update-btn" class="btn">Update Preview</button>
            <button type="button" id="print-btn" class="btn btn-print">Print Form</button>
            <button type="button" id="save-btn" class="btn btn-save">Save as PNG</button>
        </div>

        <div id="preview-container">
            <h3>Your interment form is ready to download</h3>
            <img id="preview-image" src="" alt="Interment Form Preview">
            <a id="download-link" href="#" download="interment_form.png">Download PNG</a>
        </div>

        <div class="nav-links">
            <a href="#" class="nav-link">Home</a>
            <a href="#" class="nav-link">Fill Up Form</a>
            <a href="#" class="nav-link">Ribbon Generator</a>
        </div>
    </div>

    <!-- A4 sized interment form preview (Modified Layout for better spacing) -->
    <div id="interment-preview">
        <div class="print-form">
            <img src="logo.png" alt="SIMS Logo" class="sims-logo">

            <div class="memory-text">IN LOVING MEMORY OF</div>

            <div class="name-text" id="preview-name">ESTERLITA QUIBOL GARCIA</div>

            <div class="detail-text" id="preview-born">BORN: JULY 10, 1956</div>
            <div class="detail-text" id="preview-died">DIED: MARCH 26, 2023</div>
            <div class="detail-text" id="preview-age">AGE: 66 YRS. OLD</div>

            <!-- Box for Interment Date and Placed -->
            <div class="interment-details-box">
                <div class="interment-line">
                    <span class="line-label">DATE OF INTERNMENT:</span>
                    <span class="line-content" id="preview-interment-date"></span>
                </div>
                <div class="interment-line">
                     <span class="line-label">PLACED:</span>
                     <span class="line-content" id="preview-placed"></span>
                </div>
            </div>

            <div class="serviced-by-label">SERVICED BY:</div>

            <div class="service-name-colored">
                <span class="salvador">SALVADOR</span> <span class="indigent">INDIGENT</span> <span class="memorial">MEMORIAL</span> <span class="services">SERVICES</span>
            </div>

            <!-- This element will be pushed to the bottom by margin-top: auto -->
            <div class="address-line">
                OFFICE ADDRESS: P-8 SINAYAWAN, VALENCIA CITY BUK.<br>
                CONTACT #: 0926-7921-987/0906-368-6674/0905-076-2726
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const nameInput = document.getElementById('name');
            const bornInput = document.getElementById('born');
            const diedInput = document.getElementById('died');
            const ageInput = document.getElementById('age');
            const intermentDateInput = document.getElementById('interment-date');
            const placedInput = document.getElementById('placed');

            const previewName = document.getElementById('preview-name');
            const previewBorn = document.getElementById('preview-born');
            const previewDied = document.getElementById('preview-died');
            const previewAge = document.getElementById('preview-age');
            const previewIntermentDate = document.getElementById('preview-interment-date');
            const previewPlaced = document.getElementById('preview-placed');

            const updateBtn = document.getElementById('update-btn');
            const printBtn = document.getElementById('print-btn');
            const saveBtn = document.getElementById('save-btn');
            const previewContainer = document.getElementById('preview-container');
            const previewImage = document.getElementById('preview-image');
            const downloadLink = document.getElementById('download-link');

            // Update preview when button clicked
            updateBtn.addEventListener('click', function() {
                updatePreview();
            });

            // Print form
            printBtn.addEventListener('click', function() {
                updatePreview(); // Ensure preview is up-to-date before printing
                setTimeout(() => {
                    window.print();
                }, 300); // Small delay to allow rendering
            });

            // Save as PNG
            saveBtn.addEventListener('click', function() {
                updatePreview(); // Ensure preview is up-to-date

                previewContainer.style.display = 'none';
                const elementToCapture = document.getElementById('interment-preview');

                html2canvas(elementToCapture, {
                    scale: 2,
                    useCORS: true,
                    allowTaint: true,
                    backgroundColor: "#FFFFFF",
                    // Explicitly set width/height for canvas to match A4 aspect ratio
                    // This helps if screen rendering differs slightly
                    width: elementToCapture.offsetWidth,
                    height: elementToCapture.offsetHeight
                }).then(function(canvas) {
                    const imgData = canvas.toDataURL('image/png');
                    previewImage.src = imgData;
                    downloadLink.href = imgData;
                    const filename = (nameInput.value.trim() || 'interment_form').replace(/[^a-z0-9]/gi, '_').toLowerCase() + '.png';
                    downloadLink.download = filename;
                    previewContainer.style.display = 'block';
                    previewContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }).catch(function(error) {
                    console.error('Error generating canvas:', error);
                    alert('Sorry, there was an error saving the image.');
                });
            });

            // Function to update preview with form data
            function updatePreview() {
                previewName.textContent = nameInput.value.toUpperCase() || 'ESTERLITA QUIBOL GARCIA';
                previewBorn.textContent = `BORN: ${bornInput.value || 'JULY 10, 1956'}`;
                previewDied.textContent = `DIED: ${diedInput.value || 'MARCH 26, 2023'}`;
                previewAge.textContent = `AGE: ${ageInput.value || '66'} YRS. OLD`;
                previewIntermentDate.textContent = intermentDateInput.value;
                previewPlaced.textContent = placedInput.value;
            }

             [nameInput, bornInput, diedInput, ageInput, intermentDateInput, placedInput].forEach(input => {
                 input.addEventListener('input', updatePreview);
             });

             updatePreview(); // Initial update

        });
    </script>
</body>
</html>
